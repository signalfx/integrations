
<!--- Generated by to-integrations-repo script in Smart Agent repo, DO NOT MODIFY HERE --->

### INSTALLATION

This integration is part of the [SignalFx Smart Agent](https://github.com/signalfx/integrations/tree/master/signalfx-agent)[](sfx_link:signalfx-agent)
as the `collectd/redis` monitor. You should first deploy the Smart Agent to the
same host as the service you want to monitor, and then continue with the
configuration instructions below.

<!--- GENERATED BY (This comment exists for maintaining compatibility with to-product-docs) --->

## Description

This integration primarily consists of the Smart Agent monitor `collectd/redis`.
Below is an overview of that monitor.

### Smart Agent Monitor


Monitors a redis instance using the [collectd Python Redis
plugin](https://github.com/signalfx/redis-collectd-plugin).  Supports Redis
2.8 and later.

You can capture any kind of Redis metrics like:

 * Memory used
 * Commands processed per second
 * Number of connected clients and followers
 * Number of blocked clients
 * Number of keys stored (per database)
 * Uptime
 * Changes since last save
 * Replication delay (per follower)


<!--- OVERVIEW --->
### Monitoring length of Redis lists

To monitor the length of list keys, the key and database index must be
specified in the config. Specify keys in the config file in the form
`sendListLengths: [{databaseIndex: $db_index, keyPattern: "$key_name"}]`.
`$key_name` can be a globbed pattern (only `*` is supported), in which case
all keys matching that glob will be processed.  Don't forget to surround
the pattern with double quotes or else the asterisks might be
misinterpreted.  If any keys match the glob that are not lists, an error
will be sent to the collectd logs.

Lengths will be reported to SignalFx under the metric `gauge.key_llen`, a
separate time series for each list.

**Warning**: The `KEYS` command is used to match the globs so don't try and
match something that is very big, as this command is not highly optimized and
can block other commands from executing.

Note: To avoid duplication reporting, this should only be reported in one node.
Keys can be defined in either the leader or follower config.

Sample YAML configuration with list lengths:

```yaml
monitors:
- type: collectd/redis
  host: 127.0.0.1
  port: 9100
  sendListLengths:
  - databaseIndex: 0
    keyPattern: 'mylist*'
```

<!--- SETUP --->
### Example Config

```yaml
monitors:
- type: collectd/redis
  host: 127.0.0.1
  port: 9100
```


## Configuration

To activate this monitor in the Smart Agent, add the following to your
agent config:

```
monitors:  # All monitor config goes under this key
 - type: collectd/redis
   ...  # Additional config
```

**For a list of monitor options that are common to all monitors, see [Common
Configuration](https://github.com/signalfx/signalfx-agent/tree/main/docs/monitors/../monitor-config.md#common-configuration).**


| Config option | Required | Type | Description |
| --- | --- | --- | --- |
| `pythonBinary` | no | `string` | Path to a python binary that should be used to execute the Python code. If not set, a built-in runtime will be used.  Can include arguments to the binary as well. |
| `host` | **yes** | `string` |  |
| `port` | **yes** | `integer` |  |
| `name` | no | `string` | The name for the node is a canonical identifier which is used as plugin instance. It is limited to 64 characters in length.  (**default**: "{host}:{port}") |
| `auth` | no | `string` | Password to use for authentication. |
| `sendListLengths` | no | `list of objects (see below)` | Specify a pattern of keys to lists for which to send their length as a metric. See below for more details. |
| `verbose` | no | `bool` | If `true`, verbose logging from the plugin will be enabled. (**default:** `false`) |


The **nested** `sendListLengths` config object has the following fields:

| Config option | Required | Type | Description |
| --- | --- | --- | --- |
| `databaseIndex` | **yes** | `integer` | The database index. |
| `keyPattern` | **yes** | `string` | Can be a globbed pattern (only * is supported), in which case all keys matching that glob will be processed.  The pattern should be placed in single quotes (').  Ex. `'mylist*'` |


## Metrics

Metrics that are categorized as
[container/host](https://docs.splunk.com/observability/admin/subscription-usage/monitor-imm-billing-usage.html#about-custom-bundled-and-high-resolution-metrics)
(*default*) are ***in bold and italics*** in the list below.

These are the metrics available for this integration.

 - `bytes.maxmemory` (*gauge*)<br>    Maximum memory configured on Redis server
 - `bytes.total_system_memory` (*gauge*)<br>    Total memory available on the OS
 - ***`bytes.used_memory`*** (*gauge*)<br>    Number of bytes allocated by Redis
 - `bytes.used_memory_lua` (*gauge*)<br>    Number of bytes used by the Lua engine
 - `bytes.used_memory_peak` (*gauge*)<br>    Peak Number of bytes allocated by Redis
 - ***`bytes.used_memory_rss`*** (*gauge*)<br>    Number of bytes allocated by Redis as seen by the OS
 - ***`counter.commands_processed`*** (*cumulative*)<br>    Total number of commands processed by the server
 - `counter.connections_received` (*cumulative*)<br>    Total number of connections accepted by the server
 - ***`counter.evicted_keys`*** (*cumulative*)<br>    Number of evicted keys due to maxmemory limit
 - ***`counter.expired_keys`*** (*cumulative*)<br>    Total number of key expiration events
 - `counter.lru_clock` (*cumulative*)<br>    Clock incrementing every minute, for LRU management
 - ***`counter.rejected_connections`*** (*cumulative*)<br>    Number of connections rejected because of maxclients limit
 - ***`counter.total_net_input_bytes`*** (*cumulative*)<br>    Total number of bytes inputted
 - ***`counter.total_net_output_bytes`*** (*cumulative*)<br>    Total number of bytes outputted
 - ***`counter.used_cpu_sys`*** (*cumulative*)<br>    System CPU consumed by the Redis server
 - `counter.used_cpu_sys_children` (*cumulative*)<br>    System CPU consumed by the background processes
 - ***`counter.used_cpu_user`*** (*cumulative*)<br>    User CPU consumed by the Redis server
 - `counter.used_cpu_user_children` (*cumulative*)<br>    User CPU consumed by the background processes
 - ***`derive.keyspace_hits`*** (*cumulative*)<br>    Number of successful lookup of keys in the main dictionary
 - ***`derive.keyspace_misses`*** (*cumulative*)<br>    Number of failed lookup of keys in the main dictionary
 - ***`gauge.blocked_clients`*** (*gauge*)<br>    Number of clients pending on a blocking call
 - `gauge.changes_since_last_save` (*gauge*)<br>    Number of changes since the last dump
 - `gauge.client_biggest_input_buf` (*gauge*)<br>    Biggest input buffer among current client connections
 - `gauge.client_longest_output_list` (*gauge*)<br>    Longest output list among current client connections
 - ***`gauge.connected_clients`*** (*gauge*)<br>    Number of client connections (excluding connections from followers)
 - `gauge.connected_slaves` (*gauge*)<br>    Number of connected followers
 - `gauge.db0_avg_ttl` (*gauge*)<br>    The average time to live for all keys in redis
 - `gauge.db0_expires` (*gauge*)<br>    The total number of keys in redis that will expire
 - `gauge.db0_keys` (*gauge*)<br>    The total number of keys stored in redis
 - `gauge.instantaneous_ops_per_sec` (*gauge*)<br>    Number of commands processed per second
 - `gauge.key_llen` (*gauge*)<br>    Length of an list key
 - `gauge.latest_fork_usec` (*gauge*)<br>    Duration of the latest fork operation in microseconds
 - `gauge.master_last_io_seconds_ago` (*gauge*)<br>    Number of seconds since the last interaction with leader
 - `gauge.master_link_down_since_seconds` (*gauge*)<br>    Number of seconds since the link is down
 - `gauge.master_link_status` (*gauge*)<br>    Status of the link (up/down)
 - ***`gauge.master_repl_offset`*** (*gauge*)<br>    Master replication offset
 - `gauge.mem_fragmentation_ratio` (*gauge*)<br>    Ratio between used_memory_rss and used_memory
 - `gauge.rdb_bgsave_in_progress` (*gauge*)<br>    Flag indicating a RDB save is on-going
 - `gauge.rdb_last_save_time` (*gauge*)<br>    Unix timestamp for last save to disk, when using persistence
 - `gauge.repl_backlog_first_byte_offset` (*gauge*)<br>    Slave replication backlog offset
 - ***`gauge.slave_repl_offset`*** (*gauge*)<br>    Slave replication offset
 - `gauge.uptime_in_days` (*gauge*)<br>    Number of days up
 - `gauge.uptime_in_seconds` (*gauge*)<br>    Number of seconds up

### Non-default metrics (version 4.7.0+)

**The following information applies to the agent version 4.7.0+ that has
`enableBuiltInFiltering: true` set on the top level of the agent config.**

To emit metrics that are not _default_, you can add those metrics in the
generic monitor-level `extraMetrics` config option.  Metrics that are derived
from specific configuration options that do not appear in the above list of
metrics do not need to be added to `extraMetrics`.

To see a list of metrics that will be emitted you can run `agent-status
monitors` after configuring this monitor in a running agent instance.

### Legacy non-default metrics (version < 4.7.0)

**The following information only applies to agent versions prior to 4.7.0. If
you have a newer agent and have set `enableBuiltInFiltering: true` at the top
level of your agent config, see the section above. See upgrade instructions in
[Old-style inclusion list filtering](https://github.com/signalfx/signalfx-agent/tree/main/docs/monitors/../legacy-filtering.md#old-style-inclusion-list-filtering).**

If you have a reference to the `whitelist.json` in your agent's top-level
`metricsToExclude` config option, and you want to emit metrics that are not in
that allow list, then you need to add an item to the top-level
`metricsToInclude` config option to override that allow list (see [Inclusion
filtering](https://github.com/signalfx/signalfx-agent/tree/main/docs/monitors/../legacy-filtering.md#inclusion-filtering).  Or you can just
copy the whitelist.json, modify it, and reference that in `metricsToExclude`.

## Dimensions

The following dimensions may occur on metrics emitted by the monitors. Some
dimensions may be specific to certain metrics.

#### collectd/redis monitor

| Name | Description |
| ---  | ---         |
| `plugin_instance` | Identifies the Redis instance -- will be of the form `<host>_<port>`. |
