
<!--- Generated by to-integrations-repo script in Smart Agent repo, DO NOT MODIFY HERE --->

### INSTALLATION

This integration is part of the [SignalFx Smart Agent](https://github.com/signalfx/integrations/tree/master/signalfx-agent)[](sfx_link:signalfx-agent)
as the `collectd/mongodb` monitor. You should first deploy the Smart Agent to the
same host as the service you want to monitor, and then continue with the
configuration instructions below.

<!--- GENERATED BY (This comment exists for maintaining compatibility with to-product-docs) --->

## Description

**This integration primarily consists of the Smart Agent monitor `collectd/mongodb`.
Below is an overview of that monitor.**

### Smart Agent Monitor


Monitors an instance of MongoDB using the [collectd MongoDB Python
plugin](https://github.com/signalfx/collectd-mongodb).  Requires MongoDB
2.6 or later.

This monitor captures the following metrics about MongoDB generally:

* memory
* network input/output bytes count
* heap usage
* db connections
* operations count
* active client connections
* queued operations

The plugin also captures the following DB-specific metrics:

* db size
* db counters

Documentation for MongoDB can be found [here](http://docs.mongodb.org/manual/).

<!--- SETUP --->
### Creating a MongoDB user for collectd

If you're monitoring a secured MongoDB deployment, it is a good practice to create a MongoDB user with minimal read-only roles, as follows:

```
db.createUser( {
  user: "collectd",
  pwd: "collectd",
  roles: [ { role: "readAnyDatabase", db: "admin" }, { role: "clusterMonitor", db: "admin" } ]
});
```


## Configuration

To activate this monitor in the Smart Agent, add the following to your
agent config:

```
monitors:  # All monitor config goes under this key
 - type: collectd/mongodb
   ...  # Additional config
```

**For a list of monitor options that are common to all monitors, see [Common
Configuration](https://github.com/signalfx/signalfx-agent/tree/master/docs/monitors/../monitor-config.md#common-configuration).**


| Config option | Required | Type | Description |
| --- | --- | --- | --- |
| `pythonBinary` | no | `string` | Path to a python binary that should be used to execute the Python code. If not set, a built-in runtime will be used.  Can include arguments to the binary as well. |
| `host` | **yes** | `string` | Host name/IP address of the Mongo instance |
| `port` | **yes** | `integer` | Port of the Mongo instance (default: 27017) |
| `databases` | **yes** | `list of strings` | Name(s) of database(s) that you would like metrics from. Note: the first database in this list must be "admin", as it is used to perform a `serverStatus()` command. |
| `username` | no | `string` | The MongoDB user to connect as |
| `password` | no | `string` | The password of the above user |
| `useTLS` | no | `bool` | If true, will connect to Mongo using TLS (**default:** `false`) |
| `caCerts` | no | `string` | Path to a CA cert that will be used to verify the certificate that Mongo presents (not needed if not using TLS or if Mongo's cert is signed by a globally trusted issuer already installed in the default location on your OS) |
| `tlsClientCert` | no | `string` | Path to a client certificate (not needed unless your Mongo instance requires x509 client verification) |
| `tlsClientKey` | no | `string` | Path to a client certificate key (not needed unless your Mongo instance requires x509 client verification, or if your client cert above has the key included) |
| `tlsClientKeyPassPhrase` | no | `string` | Passphrase for the TLSClientKey above |
| `sendCollectionMetrics` | no | `bool` | Whether to send collection level metrics or not (**default:** `false`) |
| `sendCollectionTopMetrics` | no | `bool` | Whether to send collection level top (timing) metrics or not (**default:** `false`) |


## Metrics

Metrics that are categorized as
[container/host](https://docs.signalfx.com/en/latest/admin-guide/usage.html#about-custom-bundled-and-high-resolution-metrics)
(*default*) are ***in bold and italics*** in the list below.

These are the metrics available for this integration.

 - `counter.asserts.regular` (*cumulative*)<br>    The number of regular assertions raised since the MongoDB process started. Check the log file for more information about these messages.
 - `counter.asserts.warning` (*cumulative*)<br>    In MongoDB 3.x and earlier, the field returns the number of warnings raised since the MongoDB process started.  In MongodDB 4, this is always 0.
 - ***`counter.backgroundFlushing.flushes`*** (*gauge*)<br>    Number of times the database has been flushed
 - ***`counter.extra_info.page_faults`*** (*gauge*)<br>    Mongod page faults
 - `counter.lock.Database.acquireCount.intentExclusive` (*cumulative*)<br>
 - `counter.lock.Database.acquireCount.intentShared` (*cumulative*)<br>
 - `counter.lock.Database.acquireCount.read` (*cumulative*)<br>
 - `counter.lock.Database.acquireCount.write` (*cumulative*)<br>
 - `counter.lock.Global.acquireCount.intentExclusive` (*cumulative*)<br>
 - `counter.lock.Global.acquireCount.intentShared` (*cumulative*)<br>
 - `counter.lock.Global.acquireCount.write` (*cumulative*)<br>
 - ***`counter.network.bytesIn`*** (*gauge*)<br>    Network bytes received by the database server
 - ***`counter.network.bytesOut`*** (*gauge*)<br>    Network bytes sent by the database server
 - ***`counter.network.numRequests`*** (*cumulative*)<br>    Requests received by the server
 - `counter.opcounters.command` (*cumulative*)<br>    Number of commands since last restart
 - ***`counter.opcounters.delete`*** (*cumulative*)<br>    Number of deletes since last restart
 - `counter.opcounters.getmore` (*cumulative*)<br>    Number of getmore operations since last restart
 - ***`counter.opcounters.insert`*** (*cumulative*)<br>    Number of inserts since last restart
 - ***`counter.opcounters.query`*** (*cumulative*)<br>    Number of queries since last restart
 - ***`counter.opcounters.update`*** (*cumulative*)<br>    Number of updates since last restart
 - `counter.opcountersRepl.command` (*cumulative*)<br>    Number of replicated commands since last restart
 - `counter.opcountersRepl.delete` (*cumulative*)<br>    Number of replicated deletes since last restart
 - `counter.opcountersRepl.getmore` (*cumulative*)<br>    Number of replicated getmore operations since last restart
 - `counter.opcountersRepl.insert` (*cumulative*)<br>    Number of replicated inserts since last restart
 - `counter.opcountersRepl.query` (*cumulative*)<br>    Number of replicated queries since last restart
 - `counter.opcountersRepl.update` (*cumulative*)<br>    Number of replicated updates since last restart
 - ***`gauge.backgroundFlushing.average_ms`*** (*gauge*)<br>    Average time (ms) to write data to disk
 - ***`gauge.backgroundFlushing.last_ms`*** (*gauge*)<br>    Most recent time (ms) spent writing data to disk
 - `gauge.collection.max` (*gauge*)<br>    Maximum number of documents in a capped collection
 - `gauge.collection.maxSize` (*gauge*)<br>    Maximum disk usage of a capped collection
 - `gauge.collections` (*gauge*)<br>    Number of collections
 - `gauge.connections.available` (*gauge*)<br>    Number of available incoming connections
 - ***`gauge.connections.current`*** (*gauge*)<br>    Number of current client connections
 - `gauge.connections.totalCreated` (*cumulative*)<br>    Count of all incoming connections created to the server. This number includes connections that have since closed.
 - ***`gauge.dataSize`*** (*gauge*)<br>    Total size of data, in bytes
 - ***`gauge.extra_info.heap_usage_bytes`*** (*gauge*)<br>    Heap size used by the mongod process, in bytes
 - ***`gauge.globalLock.activeClients.readers`*** (*gauge*)<br>    Number of active client connections performing reads
 - `gauge.globalLock.activeClients.total` (*gauge*)<br>    Total number of active client connections
 - ***`gauge.globalLock.activeClients.writers`*** (*gauge*)<br>    Number of active client connections performing writes
 - ***`gauge.globalLock.currentQueue.readers`*** (*gauge*)<br>    Read operations currently in queue
 - `gauge.globalLock.currentQueue.total` (*gauge*)<br>    Total operations currently in queue
 - ***`gauge.globalLock.currentQueue.writers`*** (*gauge*)<br>    Write operations currently in queue
 - ***`gauge.indexSize`*** (*gauge*)<br>    Total size of indexes, in bytes
 - `gauge.indexes` (*gauge*)<br>    Number of indexes across all collections
 - ***`gauge.mem.mapped`*** (*gauge*)<br>    Mongodb mapped memory usage, in MB
 - ***`gauge.mem.resident`*** (*gauge*)<br>    Mongodb resident memory usage, in MB
 - ***`gauge.mem.virtual`*** (*gauge*)<br>    Mongodb virtual memory usage, in MB
 - `gauge.numExtents` (*gauge*)<br>
 - ***`gauge.objects`*** (*gauge*)<br>    Number of documents across all collections
 - ***`gauge.storageSize`*** (*gauge*)<br>    Total bytes allocated to collections for document storage
 - ***`gauge.uptime`*** (*counter*)<br>    Uptime of this server in milliseconds

#### Group collection
All of the following metrics are part of the `collection` metric group. All of
the non-default metrics below can be turned on by adding `collection` to the
monitor config option `extraGroups`:
 - `counter.collection.index.accesses.ops` (*counter*)<br>    Number of times an index has been used (only on Mongo 3.2+)
 - `gauge.collection.avgObjSize` (*gauge*)<br>    Mean object/document size of a collection
 - `gauge.collection.count` (*gauge*)<br>    Number of objects/documents in a collection
 - `gauge.collection.indexSize` (*gauge*)<br>    Size of a particular index on a collection
 - `gauge.collection.size` (*gauge*)<br>    Size of a collection in bytes, not including indexes
 - `gauge.collection.storageSize` (*gauge*)<br>    Size of the collection on disk in bytes, never decreases.

#### Group collection-top
All of the following metrics are part of the `collection-top` metric group. All of
the non-default metrics below can be turned on by adding `collection-top` to the
monitor config option `extraGroups`:
 - `counter.collection.commandsCount` (*counter*)<br>    Number of commands issued for a collection
 - `counter.collection.commandsTime` (*counter*)<br>    Time spent in microseconds processing commands issued for a collection
 - `counter.collection.getmoreCount` (*counter*)<br>    Number of getMore requests issued for a collection
 - `counter.collection.getmoreTime` (*counter*)<br>    Time spent in microseconds processing getMore requests for a collection
 - `counter.collection.insertCount` (*counter*)<br>    Number of inserts issued for a collection
 - `counter.collection.insertTime` (*counter*)<br>    Time spent in microseconds processing insert requests for a collection
 - `counter.collection.queriesCount` (*counter*)<br>    Number of queries issued for a collection
 - `counter.collection.queriesTime` (*counter*)<br>    Time spent in microseconds processing query requests for a collection
 - `counter.collection.readLockCount` (*counter*)<br>    Number of read locks issued for a collection
 - `counter.collection.readLockTime` (*counter*)<br>    Time spent in microseconds processing read locks for a collection
 - `counter.collection.removeCount` (*counter*)<br>    Number of remove requests issued for a collection
 - `counter.collection.removeTime` (*counter*)<br>    Time spent in microseconds processing remove requests for a collection
 - `counter.collection.totalCount` (*counter*)<br>    Total number of operations issued for a collection
 - `counter.collection.totalTime` (*counter*)<br>    Time spent in microseconds processing all operations for a collection
 - `counter.collection.updateCount` (*counter*)<br>    Number of update requests issued for a collection
 - `counter.collection.updateTime` (*counter*)<br>    Time spent in microseconds processing update requests for a collection
 - `counter.collection.writeLockCount` (*counter*)<br>    Number of write locks issued for a collection
 - `counter.collection.writeLockTime` (*counter*)<br>    Time spent in microseconds processing write locks for a collection

### Non-default metrics (version 4.7.0+)

**The following information applies to the agent version 4.7.0+ that has
`enableBuiltInFiltering: true` set on the top level of the agent config.**

To emit metrics that are not _default_, you can add those metrics in the
generic monitor-level `extraMetrics` config option.  Metrics that are derived
from specific configuration options that do not appear in the above list of
metrics do not need to be added to `extraMetrics`.

To see a list of metrics that will be emitted you can run `agent-status
monitors` after configuring this monitor in a running agent instance.

### Legacy non-default metrics (version < 4.7.0)

**The following information only applies to agent version older than 4.7.0. If
you have a newer agent and have set `enableBuiltInFiltering: true` at the top
level of your agent config, see the section above. See upgrade instructions in
[Old-style whitelist filtering](https://github.com/signalfx/signalfx-agent/tree/master/docs/monitors/../legacy-filtering.md#old-style-whitelist-filtering).**

If you have a reference to the `whitelist.json` in your agent's top-level
`metricsToExclude` config option, and you want to emit metrics that are not in
that whitelist, then you need to add an item to the top-level
`metricsToInclude` config option to override that whitelist (see [Inclusion
filtering](https://github.com/signalfx/signalfx-agent/tree/master/docs/monitors/../legacy-filtering.md#inclusion-filtering).  Or you can just
copy the whitelist.json, modify it, and reference that in `metricsToExclude`.

## Dimensions

The following dimensions may occur on metrics emitted by the monitors. Some
dimensions may be specific to certain metrics.

#### collectd/mongodb monitor

| Name | Description |
| ---  | ---         |
| `plugin_instance` | Port number of the MongoDB instance |
